<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Leaflet-layer-overpass by kartenkarsten</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Leaflet-layer-overpass</h1>
        <p class="header">This is an simple way to bring OSM data as POI overlay on your leaflet Map</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/kartenkarsten/leaflet-layer-overpass/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/kartenkarsten/leaflet-layer-overpass/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/kartenkarsten/leaflet-layer-overpass">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/kartenkarsten">kartenkarsten</a></p>


      </header>
      <section>
        <h1>
<a id="leaflet-layer-overpass" class="anchor" href="#leaflet-layer-overpass" aria-hidden="true"><span class="octicon octicon-link"></span></a>Leaflet Layer OverPass</h1>

<h2>
<a id="what-is-it-" class="anchor" href="#what-is-it-" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is it ?</h2>

<p>A <a href="http://leafletjs.com/">Leaflet</a> Plugin to create a custom POI overlay - thanks to the <a href="http://www.openstreetmap.org/">OSM</a>-Dataset and the <a href="http://overpass-api.de/">OverPass-API</a></p>

<p>checkout the <a href="http://kartenkarsten.github.io/leaflet-layer-overpass/demo/">Demo</a></p>

<h2>
<a id="how-to-use-it-" class="anchor" href="#how-to-use-it-" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to use it ?</h2>

<div class="highlight highlight-javascript"><pre><span class="pl-s">var</span> attr_osm <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>Map data &amp;copy; &lt;a href="http://openstreetmap.org/"&gt;OpenStreetMap&lt;/a&gt; contributors<span class="pl-pds">'</span></span>,
attr_overpass <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>POI via &lt;a href="http://www.overpass-api.de/"&gt;Overpass API&lt;/a&gt;<span class="pl-pds">'</span></span>;
<span class="pl-s">var</span> osm <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">L.TileLayer</span>(<span class="pl-s1"><span class="pl-pds">'</span>http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png<span class="pl-pds">'</span></span>, {opacity<span class="pl-k">:</span> <span class="pl-c1">0.7</span>, attribution<span class="pl-k">:</span> [attr_osm, attr_overpass].<span class="pl-s3">join</span>(<span class="pl-s1"><span class="pl-pds">'</span>, <span class="pl-pds">'</span></span>)});

<span class="pl-s">var</span> map <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">L.Map</span>(<span class="pl-s1"><span class="pl-pds">'</span>map<span class="pl-pds">'</span></span>).addLayer(osm).setView(<span class="pl-k">new</span> <span class="pl-en">L.LatLng</span>(<span class="pl-c1">52.265</span>, <span class="pl-c1">10.524</span>), <span class="pl-c1">14</span>);

<span class="pl-c">//OverPassAPI overlay</span>
<span class="pl-s">var</span> opl <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">L.OverPassLayer</span>({
  query<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>node(BBOX)[amenity=post_box];out;<span class="pl-pds">"</span></span>,
}

map.addLayer(opl);</pre></div>

<p>In order to get an valid query the <a href="http://overpass-turbo.eu/">Overpass-turbo IDE</a> might help.</p>

<h2>
<a id="what-are-the-options-" class="anchor" href="#what-are-the-options-" aria-hidden="true"><span class="octicon octicon-link"></span></a>What are the options ?</h2>

<p>You can specify an options object as an argument of L.OverPassLayer.</p>

<div class="highlight highlight-javascript"><pre>options<span class="pl-k">:</span> {
  endpoint<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>http://overpass.osm.rambler.ru/cgi/<span class="pl-pds">"</span></span>,
  query<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>node(BBOX)[amenity=post_box];out;<span class="pl-pds">"</span></span>,
  <span class="pl-en">callback</span>: <span class="pl-st">function</span>(<span class="pl-vpf">data</span>) {
    <span class="pl-k">for</span>(i<span class="pl-k">=</span><span class="pl-c1">0</span>;i<span class="pl-k">&lt;</span>data.<span class="pl-sc">elements</span>.<span class="pl-sc">length</span>;i<span class="pl-k">++</span>) {
      e <span class="pl-k">=</span> data.<span class="pl-sc">elements</span>[i];

      <span class="pl-k">if</span> (e.<span class="pl-sc">id</span> <span class="pl-k">in</span> <span class="pl-v">this</span>.instance._ids) <span class="pl-k">return</span>;
      <span class="pl-v">this</span>.instance._ids[e.<span class="pl-sc">id</span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>;
      <span class="pl-s">var</span> pos <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">L.LatLng</span>(e.lat, e.lon);
      <span class="pl-s">var</span> popup <span class="pl-k">=</span> <span class="pl-v">this</span>.instance._poiInfo(e.<span class="pl-sc">tags</span>);
      <span class="pl-s">var</span> color <span class="pl-k">=</span> e.<span class="pl-sc">tags</span>.collection_times <span class="pl-k">?</span> <span class="pl-s1"><span class="pl-pds">'</span>green<span class="pl-pds">'</span></span><span class="pl-k">:</span><span class="pl-s1"><span class="pl-pds">'</span>red<span class="pl-pds">'</span></span>;
      <span class="pl-s">var</span> circle <span class="pl-k">=</span> L.circle(pos, <span class="pl-c1">50</span>, {
        color<span class="pl-k">:</span> color,
        fillColor<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>#fa3<span class="pl-pds">'</span></span>,
        fillOpacity<span class="pl-k">:</span> <span class="pl-c1">0.5</span>
      })
      .bindPopup(popup);
      <span class="pl-v">this</span>.instance.addLayer(circle);
    }
  },
};</pre></div>

<h2>
<a id="used-by" class="anchor" href="#used-by" aria-hidden="true"><span class="octicon octicon-link"></span></a>Used by</h2>

<ul>
<li><a href="http://gdzie.bl.ee/#!7/51.495/20.995/">Gdzie</a></li>
<li><a href="http://pois.elblogdehumitos.com.ar/">pois.elblogdehumitos.com.ar</a></li>
</ul>

<h2>
<a id="dependencies" class="anchor" href="#dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dependencies</h2>

<ul>
<li>JQuery (version 1.8.0 is working). JQuery does the AJAX requests and creats the popup content. (Might be replaceable by <a href="https://github.com/calvinmetcalf/leaflet-ajax">Leaflet-Ajax</a>)</li>
<li>Leaflet (tried with version 0.6.2, 0.7.3)</li>
</ul>

<h2>
<a id="further-ideas" class="anchor" href="#further-ideas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Further Ideas</h2>

<ul>
<li>OverPass result to -&gt; geoJSON to -&gt; Leaflet Layer to support ways and areas as well (see also <a href="https://github.com/simon04/POImap/blob/master/railway.html">PoiMap</a>, <a href="https://github.com/tyrasd/overpass-ide/blob/gh-pages/js/overpass.js">OverPassTurbo</a>)</li>
<li>remove JQuery dependency</li>
<li>improve popup text. use links, format addresses and contact details (compare with <a href="http://www.openlinkmap.org/">OpenLinkMap</a>)</li>
<li>improve caching - allow to store data for some days in browser</li>
</ul>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
